<div class="row">
  <div style="" id="pre_foot">
      <h1 class="text-center">FIND YOUR PERFECT HOST</h1>
  </div>
</div>

<div class="row" id="search_box">
  <div class="col-xs-10 col-xs-offset-1">
  <%= form_tag '/experiences_search', :class => "form-inline" do %>

    <div class='input-group date col-sm-3 col-xs-12' id='datetimepickerfrom'>
      <input type='text' name="dateFR" class="form-control" />
      <span class="input-group-addon">
        <span class="glyphicon glyphicon-calendar"></span>
      </span>
    </div>

    <div class='input-group date col-sm-3 col-xs-12' id='datetimepickerto'>
      <input type='text' name="dateTO" class="form-control" />
      <span class="input-group-addon">
        <span class="glyphicon glyphicon-calendar"></span>
      </span>
    </div>

    <%= select("experience", "location", Experience.get_location.collect {|p| [ p, p ] }, {}, class: "form-control col-sm-2", style:"margin-right:5px") %>

    <div class="input-group col-sm-2 col-xs-12">
      <%= select_tag "max_group_size", options_for_select(1..10, @group_size),
        {prompt:"Guests", class:"form-control"} %>
    </div>

    <%= submit_tag "Filter", id:'filter',
        class: "btn btn-success pull-right col-sm-2 col-xs-12" %>
  <% end %>
  </div>
</div>


<div class="container" style="margin-top:40px" id="view">
 <% @experiences.in_groups_of(3, false).each do |group| %>
    <div class="row">
      <% group.each do |experience| %>
        <div class="col-md-4">
          <div class="thumbnail">
            <% if experience.images.present? %>
              <%= image_tag experience.images.first.image_file.url(:medium)%>
            <% end %>
            <div class="caption" style="background-color: #D4D4D4; height: 100%">
              <div id="avataro">
                <% if experience.host.images.present? %>
                  <%= image_tag experience.host.images.first.image_file.url(:thumb), class: "img-circle"%>
                <% end %>
              </div>

              <p><%= link_to experience.host.username,  host_path(experience.host_id.to_s) %></p>
              <p>
                Rating:
                <%= experience.testimonials.present? ? experience.avg_rating.to_s + " / " + pluralize(experience.testimonials.count, "review") + "": '-'%>
              </p>

              <h3>
                <%= link_to truncate(experience.title, length: 20), experience_path(experience.id) %>
              </h3>

             <!--  <p><a href="#" class="btn btn-info btn-xs" role="button">Button</a></p> -->
              <p style="text-align: left"><%= link_to 'More info', experience, class: "btn btn-info btn-xs", style: "color:#fff" %>
                <% if current_host == experience.host || current_admin %>
                  | <%= link_to 'Edit', edit_experience_path(experience), class: "btn btn-warning btn-xs btn_admins" %> |
                  <%= link_to 'Destroy', experience, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger btn-xs", style: "color:#fff" %>
                <% end %>
              </p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<script type="text/javascript">
  $(function () {
    $('#datetimepickerfrom').datetimepicker({
      format: 'MMMM DD, YYYY',
      minDate: moment().add(5, 'days'),
      <% if @input_datefrom.present? %>
      defaultDate: moment().add(<%=  (@input_datefrom - Date.new(Time.now.year, Time.now.month, Time.now.day)).to_i %>, 'days'),
      <% end %>
    });
    $('#datetimepickerto').datetimepicker({
      format: 'MMMM DD, YYYY',
      minDate: moment().add(5, 'days'),
      <% if @input_dateto.present? %>
      defaultDate: moment().add(<%=  (@input_dateto - Date.new(Time.now.year, Time.now.month, Time.now.day)).to_i %>, 'days'),
      <% end %>
    });
    $("#datetimepickerfrom").on("dp.change", function (e) {
        $('#datetimepickerto').data("DateTimePicker").minDate(e.date);
    });
    $("#datetimepickerto").on("dp.change", function (e) {
        $('#datetimepickerfrom').data("DateTimePicker").maxDate(e.date);
    });

    $('#experience_location').val('<%= @location ||= 'All' %>');

    <% if @input_datefrom.present? || @location != 'All'%>
      location.hash = '#view'
    <% end %>
//  Date.strptime('April 13, 2015',"%B %d, %Y")
  });
</script>
